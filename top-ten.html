<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Top 10 Movies for Reeves</title>
  <style>
    :root{
      --bg:#0b0f14;
      --panel:#101826;
      --panel2:#0f1623;
      --text:#e6edf3;
      --muted:#9fb0c0;
      --border:#223147;
      --accent:#7aa2ff;
      --accent2:#34d399;
      --shadow: 0 10px 30px rgba(0,0,0,.35);
      --radius:14px;
    }
    *{box-sizing:border-box}
    body{
      margin:0;
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji","Segoe UI Emoji";
      background: radial-gradient(1200px 800px at 20% -10%, rgba(122,162,255,.18), transparent 60%),
                  radial-gradient(900px 700px at 120% 10%, rgba(52,211,153,.10), transparent 55%),
                  var(--bg);
      color:var(--text);
    }
    a{color:var(--accent); text-decoration:none}
    a:hover{text-decoration:underline}
    .app{
      display:grid;
      grid-template-columns: 340px 1fr;
      min-height:100vh;
    }
    .sidebar{
      position:sticky;
      top:0;
      height:100vh;
      padding:18px 16px;
      border-right:1px solid var(--border);
      background: linear-gradient(180deg, rgba(16,24,38,.92), rgba(11,15,20,.92));
      backdrop-filter: blur(10px);
    }
    .brand{
      display:flex;
      gap:10px;
      align-items:center;
      padding:10px 10px 14px;
      border:1px solid var(--border);
      border-radius: var(--radius);
      background: rgba(16,24,38,.55);
      box-shadow: var(--shadow);
    }
    .brand h1{
      margin:0;
      font-size:16px;
      letter-spacing:.2px;
      line-height:1.2;
    }
    .brand p{
      margin:4px 0 0;
      font-size:12px;
      color:var(--muted);
      line-height:1.3;
    }
    .badge{
      flex:0 0 auto;
      width:34px;height:34px;
      border-radius:10px;
      background: linear-gradient(135deg, rgba(122,162,255,.9), rgba(52,211,153,.75));
      display:grid;place-items:center;
      font-weight:800;
      color:#071018;
    }
    .controls{
      margin:14px 0 10px;
      display:flex;
      gap:10px;
      align-items:center;
    }
    .search{
      width:100%;
      background: rgba(15,22,35,.8);
      border:1px solid var(--border);
      color:var(--text);
      border-radius: 12px;
      padding:10px 12px;
      outline:none;
    }
    .pill{
      border:1px solid var(--border);
      background: rgba(15,22,35,.6);
      color:var(--muted);
      border-radius:999px;
      padding:8px 10px;
      font-size:12px;
      cursor:pointer;
      user-select:none;
      white-space:nowrap;
    }
    .pill[aria-pressed="true"]{
      color:var(--text);
      border-color: rgba(122,162,255,.55);
      background: rgba(122,162,255,.12);
    }
    .list{
      margin-top:10px;
      display:flex;
      flex-direction:column;
      gap:8px;
      overflow:auto;
      height: calc(100vh - 170px);
      padding-right:4px;
      /* Hide scrollbar */
      scrollbar-width: none; /* Firefox */
      -ms-overflow-style: none; /* Internet Explorer 10+ */
    }
    .list::-webkit-scrollbar {
      display: none; /* WebKit */
    }
    .item{
      border:1px solid var(--border);
      background: rgba(15,22,35,.55);
      border-radius: 12px;
      padding:10px 10px;
      cursor:pointer;
      transition: transform .08s ease, border-color .15s ease, background .15s ease;
      display:flex;
      gap:10px;
      align-items:flex-start;
    }
    .item:hover{ border-color: rgba(122,162,255,.45); }
    .num{
      flex:0 0 auto;
      width:28px;height:28px;
      border-radius:10px;
      background: rgba(122,162,255,.12);
      border:1px solid rgba(122,162,255,.30);
      display:grid;place-items:center;
      font-weight:700;
      color:var(--text);
      font-size:12px;
      margin-top:1px;
    }
    .meta{min-width:0}
    .title{
      margin:0;
      font-weight:700;
      font-size:13px;
      line-height:1.25;
      color:var(--text);
      word-break:break-word;
    }
    .sub{
      margin:4px 0 0;
      color:var(--muted);
      font-size:12px;
      line-height:1.35;
    }
    .content{
      padding:22px 22px 80px;
      max-width: 980px;
      width: 100%;
      margin: 0 auto;
    }
    .hero{
      display:flex;
      justify-content:space-between;
      gap:14px;
      flex-wrap:wrap;
      align-items:flex-end;
      padding:18px 18px;
      border:1px solid var(--border);
      border-radius: var(--radius);
      background: rgba(16,24,38,.55);
      box-shadow: var(--shadow);
    }
    .hero h2{
      margin:0;
      font-size:20px;
      letter-spacing:.2px;
    }
    .hero p{
      margin:6px 0 0;
      color:var(--muted);
      line-height:1.4;
      max-width: 66ch;
    }
    .actions{
      display:flex;
      gap:10px;
      align-items:center;
      flex-wrap:wrap;
    }
    .btn{
      border:1px solid var(--border);
      background: rgba(15,22,35,.6);
      color:var(--text);
      padding:10px 12px;
      border-radius: 12px;
      cursor:pointer;
      font-weight:600;
      font-size:13px;
    }
    .btn.primary{
      border-color: rgba(52,211,153,.45);
      background: rgba(52,211,153,.10);
    }
    .grid{
      margin-top:16px;
      display:grid;
      grid-template-columns: 1fr;
      gap:12px;
    }
    .card{
      border:1px solid var(--border);
      border-radius: var(--radius);
      background: rgba(15,22,35,.50);
      box-shadow: var(--shadow);
      overflow:hidden;
    }
    .cardHeader{
      display:flex;
      justify-content:space-between;
      align-items:flex-start;
      gap:12px;
      padding:14px 14px 10px;
      border-bottom:1px solid rgba(34,49,71,.55);
      background: rgba(16,24,38,.35);
    }
    .cardHeader .left{
      min-width:0;
    }
    .cardHeader h3{
      margin:0;
      font-size:16px;
      line-height:1.25;
      word-break:break-word;
    }
    .cardHeader .chips{
      display:flex;
      gap:8px;
      flex-wrap:wrap;
      margin-top:8px;
    }
    .chip{
      font-size:12px;
      color:var(--muted);
      padding:6px 10px;
      border-radius:999px;
      border:1px solid var(--border);
      background: rgba(11,15,20,.35);
    }
    .rt-chip{
      color: #FA320A;
      border-color: rgba(250,50,10,.35);
      background: rgba(250,50,10,.10);
      font-weight: 600;
    }
    .cardBody{
      padding:12px 14px 14px;
      display:grid;
      gap:12px;
    }
    .sectionTitle{
      margin:0;
      font-size:12px;
      letter-spacing:.12em;
      color: var(--muted);
      text-transform: uppercase;
    }
    .textBlock{
      margin:6px 0 0;
      color:var(--text);
      line-height:1.5;
    }
    .rtLink{
      display:inline-flex;
      align-items:center;
      gap:8px;
      font-weight:700;
      font-size:13px;
      padding:10px 12px;
      border-radius: 12px;
      border:1px solid rgba(250,50,10,.35);
      background: rgba(250,50,10,.10);
      color: #FA320A;
      white-space:nowrap;
      text-decoration: none;
      transition: background-color 0.15s ease, border-color 0.15s ease;
    }
    .rtLink:hover{
      background: rgba(250,50,10,.20);
      border-color: rgba(250,50,10,.50);
      text-decoration: none;
    }
    .watchedBtn{
      display:inline-flex;
      align-items:center;
      justify-content:center;
      width:36px;
      height:36px;
      border-radius: 12px;
      border:1px solid var(--border);
      background: rgba(15,22,35,.6);
      color:var(--muted);
      cursor:pointer;
      transition: background-color 0.15s ease, border-color 0.15s ease, color 0.15s ease;
    }
    .watchedBtn:hover{
      background: rgba(15,22,35,.8);
      border-color: rgba(122,162,255,.35);
      color:var(--text);
    }
    .watchedBtn.watched{
      background: rgba(34,197,94,.10);
      border-color: rgba(34,197,94,.35);
      color: #22c55e;
    }
    .watchedBtn.watched:hover{
      background: rgba(34,197,94,.15);
      border-color: rgba(34,197,94,.50);
    }
    
    /* Animation for marking as watched */
    @keyframes watchedComplete {
      0% { transform: scale(1); }
      50% { transform: scale(1.15); background: rgba(34,197,94,.3); }
      100% { transform: scale(1); }
    }
    
    @keyframes cardCollapse {
      0% { 
        transform: scale(1);
        opacity: 1;
        max-height: 1000px;
        margin-bottom: 12px;
      }
      50% { 
        transform: scale(0.98);
        opacity: 0.7;
        max-height: 1000px;
        margin-bottom: 12px;
      }
      80% { 
        transform: scale(0.95);
        opacity: 0.3;
        max-height: 50px;
        margin-bottom: 6px;
      }
      100% { 
        transform: scale(0.92);
        opacity: 0.1;
        max-height: 0px;
        margin-bottom: 0px;
      }
    }
    
    @keyframes itemCollapse {
      0% { 
        transform: scale(1);
        opacity: 1;
        max-height: 100px;
        margin-bottom: 8px;
      }
      50% { 
        transform: scale(0.98);
        opacity: 0.7;
        max-height: 100px;
        margin-bottom: 8px;
      }
      80% { 
        transform: scale(0.95);
        opacity: 0.3;
        max-height: 30px;
        margin-bottom: 4px;
      }
      100% { 
        transform: scale(0.92);
        opacity: 0.1;
        max-height: 0px;
        margin-bottom: 0px;
      }
    }
    
    .watchedBtn.completing {
      animation: watchedComplete 0.5s ease-out;
    }
    
    .card.completing {
      animation: cardCollapse 1.2s ease-in-out;
      overflow: hidden;
    }
    
    .item.completing {
      animation: itemCollapse 1.2s ease-in-out;
      overflow: hidden;
    }
    .rtLink svg{opacity:.9}
    .muted{color:var(--muted)}
    .hint{
      margin-top:10px;
      font-size:12px;
      color:var(--muted);
    }
    .footer{
      margin-top:18px;
      font-size:12px;
      color:var(--muted);
    }
    @media (max-width: 880px){
      .app{grid-template-columns: 1fr}
      .sidebar{position:relative;height:auto}
      .list{height:auto; max-height: 320px}
      .content{padding:16px 16px 60px}
    }
  

    .cardBody{display:grid;grid-template-columns:110px 1fr;gap:14px;align-items:start;}
    .poster{width:110px;aspect-ratio:2/3;border-radius:14px;object-fit:cover;background:rgba(255,255,255,.06);border:1px solid rgba(255,255,255,.08);}
    .cardContent{display:grid;grid-template-columns:1fr 1fr;gap:16px;}
    @media (max-width: 820px){
      .cardBody{grid-template-columns:82px 1fr;}
      .poster{width:82px;border-radius:12px;}
      .cardContent{grid-template-columns:1fr;}
    }

</style>
</head>
<body>
  <div class="app">
    <aside class="sidebar">
      <div class="brand">
        <div class="badge">10</div>
        <div>
          <h1>Top 10 Movies for Reeves</h1>
        </div>
      </div>

      <div class="controls">
        <input id="search" class="search" placeholder="Search movies‚Ä¶" aria-label="Search movies" />
        <button id="toggleBonus" class="pill" aria-pressed="true" title="Show/hide bonus movies">Bonus</button>
      </div>

      <div id="list" class="list" aria-label="Movie list"></div>
      <div class="hint">Tip: Use ‚Üë/‚Üì then Enter to open.</div>
    </aside>

    <main class="content">
      <div class="hero">
        <div>
          <h2 id="pageTitle">Start Watching üìΩÔ∏è</h2>
          <p id="pageDesc" class="muted">The movies are listed in the recommended watching order.</p>
        </div>
        <div class="actions">
          <button id="toggleExpand" class="btn">Collapse all</button>
        </div>
      </div>

      <div id="grid" class="grid" aria-label="Movie details"></div>

      <div class="footer">
        Source text: PDF export v1.0.1.2026-01-04.
      </div>
    </main>
  </div>

<script>
  const MOVIES = [
    {
      id:"shawshank",
      rank: 1,
      title:"The Shawshank Redemption",
      poster:"https://resizing.flixster.com/-XZAfHZM39UwaGJIFWKAE8fS0ak%3D/v3/t/assets/p15987_p_v13_ap.jpg",
      rtRating: 91,
      what:[
        "A quietly powerful prison drama about hope, friendship, and endurance.",
        "Character-driven and emotionally satisfying from start to finish."
      ],
      why:[
        "Consistently ranked among the greatest films ever made.",
        "Universally loved across ages, genres, and movie tastes."
      ],
      rt:"https://www.rottentomatoes.com/m/shawshank_redemption",
      bonus:false
    },
    {
      id:"getout",
      rank: 2,
      title:"Get Out",
      poster:"https://resizing.flixster.com/-XZAfHZM39UwaGJIFWKAE8fS0ak%3D/v3/t/assets/p13365032_p_v8_bb.jpg",
      rtRating: 98,
      what:[
        "A tense psychological thriller blending horror with sharp social commentary.",
        "Fast-moving, unsettling, and darkly funny."
      ],
      why:[
        "Redefined modern horror with intelligence and relevance.",
        "Won an Oscar for Best Original Screenplay."
      ],
      rt:"https://www.rottentomatoes.com/m/get_out",
      bonus:false
    },
    {
      id:"pulpfiction",
      rank: 3,
      title:"Pulp Fiction",
      poster:"https://resizing.flixster.com/-XZAfHZM39UwaGJIFWKAE8fS0ak%3D/v3/t/assets/p15684_p_v8_ai.jpg",
      rtRating: 92,
      what:[
        "Interwoven crime stories told out of order with style and humor.",
        "Dialogue-driven, violent, and endlessly quotable."
      ],
      why:[
        "Changed how movies could be structured and written.",
        "A defining film of the 1990s and indie cinema boom."
      ],
      rt:"https://www.rottentomatoes.com/m/pulp_fiction",
      bonus:false
    },
    {
      id:"goodwill",
      rank: 4,
      title:"Good Will Hunting",
      poster:"https://resizing.flixster.com/-XZAfHZM39UwaGJIFWKAE8fS0ak%3D/v3/t/assets/p20224_p_v8_aa.jpg",
      rtRating: 97,
      what:[
        "A gifted young man struggles with trauma, identity, and potential.",
        "Warm, human, and emotionally grounded."
      ],
      why:[
        "Launched Matt Damon and Ben Affleck‚Äôs careers.",
        "Features an iconic, Oscar-winning Robin Williams performance."
      ],
      rt:"https://www.rottentomatoes.com/m/good_will_hunting",
      bonus:false
    },
    {
      id:"alien",
      rank: 5,
      title:"Alien",
      poster:"https://resizing.flixster.com/-XZAfHZM39UwaGJIFWKAE8fS0ak%3D/v3/t/assets/p2571_p_v8_aw.jpg",
      rtRating: 93,
      what:[
        "A slow-burn sci-fi horror set aboard a stranded spaceship.",
        "Claustrophobic, suspenseful, and visually striking."
      ],
      why:[
        "Perfectly blends science fiction and horror.",
        "Introduced one of cinema‚Äôs greatest monsters‚Äîand heroines."
      ],
      rt:"https://www.rottentomatoes.com/m/alien",
      bonus:false
    },
    {
      id:"silence",
      rank: 6,
      title:"The Silence of the Lambs",
      poster:"https://resizing.flixster.com/-XZAfHZM39UwaGJIFWKAE8fS0ak%3D/v3/t/assets/p13013_p_v10_ao.jpg",
      rtRating: 96,
      what:[
        "A psychological thriller about hunting a serial killer.",
        "Chilling, intelligent, and relentlessly tense."
      ],
      why:[
        "One of the few films to win all five major Oscars.",
        "Hannibal Lecter became an iconic villain."
      ],
      rt:"https://www.rottentomatoes.com/m/silence_of_the_lambs",
      bonus:false
    },
    {
      id:"killbill1",
      rank: 7,
      title:"Kill Bill: Vol. 1",
      poster:"https://resizing.flixster.com/-XZAfHZM39UwaGJIFWKAE8fS0ak%3D/v3/t/assets/p32988_p_v8_aa.jpg",
      rtRating: 85,
      what:[
        "A stylized revenge epic blending martial arts, anime, and westerns.",
        "Fast, colorful, and unapologetically fun."
      ],
      why:[
        "Quentin Tarantino at his most playful and kinetic.",
        "A cult favorite known for unforgettable action sequences."
      ],
      rt:"https://www.rottentomatoes.com/m/kill_bill_vol_1",
      bonus:false
    },
    {
      id:"parasite",
      rank: 8,
      title:"Parasite",
      poster:"https://resizing.flixster.com/0nQ2niq2j-E4gdW_kB5H606atmc%3D/ems.cHJkLWVtcy1hc3NldHMvbW92aWVzLzZlZWEwMmY4LTk1OWUtNGEyOS04ODRmLTA0OWRjMzhlYWZkNi53ZWJw",
      rtRating: 99,
      what:[
        "A genre-shifting thriller about class, family, and deception.",
        "Funny, tense, shocking, and unpredictable."
      ],
      why:[
        "First non-English film to win Best Picture.",
        "Praised worldwide for its storytelling precision."
      ],
      rt:"https://www.rottentomatoes.com/m/parasite_2019",
      bonus:false
    },
    {
      id:"nocountry",
      rank: 9,
      title:"No Country for Old Men",
      poster:"https://resizing.flixster.com/-XZAfHZM39UwaGJIFWKAE8fS0ak%3D/v3/t/assets/p170313_p_v10_as.jpg",
      rtRating: 93,
      what:[
        "A modern western about fate, violence, and moral decay.",
        "Minimal dialogue and relentless tension."
      ],
      why:[
        "A masterclass in visual storytelling by the Coen Brothers.",
        "Features one of cinema‚Äôs most terrifying villains."
      ],
      rt:"https://www.rottentomatoes.com/m/no_country_for_old_men",
      bonus:false
    },
    {
      id:"banshees",
      rank: 10,
      title:"The Banshees of Inisherin",
      poster:"https://resizing.flixster.com/SqYohHz5ela5G1qTZ8aKYunK2Oo%3D/ems.cHJkLWVtcy1hc3NldHMvbW92aWVzLzc4ZjI3ZDBiLTkwMDktNDVkZC1hZmI5LTJiNDdjNWRmZDVjOC5qcGc%3D",
      rtRating: 96,
      what:[
        "A darkly funny, melancholic story of friendship and isolation.",
        "Quiet, strange, and emotionally resonant."
      ],
      why:[
        "Acclaimed for its writing, performances, and tone.",
        "A defining modern example of prestige cinema."
      ],
      rt:"https://www.rottentomatoes.com/m/the_banshees_of_inisherin",
      bonus:false
    },

    // Bonus
    {
      id:"threebillboards",
      rank: "B1",
      title:"Three Billboards Outside Ebbing, Missouri",
      poster:"https://resizing.flixster.com/Zd8kHAMa3SRSR2WgqQLOpVJD_Wg%3D/ems.cHJkLWVtcy1hc3NldHMvbW92aWVzLzQ4NGIxYWEyLWU0ZjAtNGNhYy05YjM0LTViMGYwNzEwNWJmYy53ZWJw",
      rtRating: 90,
      what:[
        "A grieving mother challenges a small town over justice and accountability.",
        "Angry, funny, and emotionally raw."
      ],
      why:[
        "Known for powerhouse performances and moral complexity.",
        "Sparked major awards buzz and debate."
      ],
      rt:"https://www.rottentomatoes.com/m/three_billboards_outside_ebbing_missouri",
      bonus:true
    },
    {
      id:"lawrence",
      rank: "B2",
      title:"Lawrence of Arabia",
      poster:"https://resizing.flixster.com/eBMrQ-GdDu0AfQXG1kK-Pv-19bc%3D/ems.cHJkLWVtcy1hc3NldHMvbW92aWVzLzkxZWJmOTkxLWYwZDEtNGQ5My05ZGE1LTU4YjcwODBlMmMyYS5qcGc%3D",
      rtRating: 97,
      what:[
        "A sweeping historical epic set during World War I.",
        "Grand scale, slow pacing, and stunning desert imagery."
      ],
      why:[
        "Considered one of the greatest films ever made.",
        "A landmark in cinematography and epic storytelling."
      ],
      rt:"https://www.rottentomatoes.com/m/lawrence_of_arabia",
      bonus:true
    },
  ];

  // State
  let showBonus = true;
  let query = "";
  let focusedIndex = -1;
  
  // Load watched movies from localStorage
  let watchedMovies = new Set();
  try {
    const saved = localStorage.getItem('watchedMovies');
    if (saved) {
      watchedMovies = new Set(JSON.parse(saved));
    }
  } catch (e) {
    console.warn('Failed to load watched movies from localStorage:', e);
  }

  const $ = (sel) => document.querySelector(sel);
  const listEl = $("#list");
  const gridEl = $("#grid");
  const searchEl = $("#search");
  const toggleBonusEl = $("#toggleBonus");
  const pageTitleEl = $("#pageTitle");
  const pageDescEl = $("#pageDesc");

  function visibleMoviesForGrid(){
    return MOVIES.filter(m => (showBonus || !m.bonus))
      .sort((a, b) => {
        // Sort watched movies to the bottom
        const aWatched = watchedMovies.has(a.id);
        const bWatched = watchedMovies.has(b.id);
        if (aWatched !== bWatched) {
          return aWatched ? 1 : -1; // Watched movies go to bottom
        }
        // Keep original order for movies in same watched state
        return 0;
      });
  }

  function visibleMoviesForSidebar(){
    const q = query.trim().toLowerCase();
    return visibleMoviesForGrid()
      .filter(m => !q || m.title.toLowerCase().includes(q))
      .sort((a, b) => {
        // Sort watched movies to the bottom
        const aWatched = watchedMovies.has(a.id);
        const bWatched = watchedMovies.has(b.id);
        if (aWatched !== bWatched) {
          return aWatched ? 1 : -1; // Watched movies go to bottom
        }
        // Keep original order for movies in same watched state
        return 0;
      });
  }

  function toggleWatched(movieId) {
    const wasWatched = watchedMovies.has(movieId);
    
    if (wasWatched) {
      watchedMovies.delete(movieId);
    } else {
      watchedMovies.add(movieId);
      
      // Trigger completion animation for newly watched movies
      const card = document.getElementById("card-" + movieId);
      const sidebarItem = document.querySelector(`[data-id="${movieId}"]`);
      const watchedBtn = card?.querySelector('.watchedBtn');
      
      if (watchedBtn) {
        watchedBtn.classList.add('completing');
        setTimeout(() => watchedBtn.classList.remove('completing'), 500);
      }
      
      if (card) {
        card.classList.add('completing');
        setTimeout(() => card.classList.remove('completing'), 1200);
      }
      
      if (sidebarItem) {
        sidebarItem.classList.add('completing');
        setTimeout(() => sidebarItem.classList.remove('completing'), 1200);
      }
    }
    
    // Save to localStorage
    try {
      localStorage.setItem('watchedMovies', JSON.stringify([...watchedMovies]));
    } catch (e) {
      console.warn('Failed to save watched movies to localStorage:', e);
    }
    
    // Delay re-render to allow animation to play
    setTimeout(() => {
      renderList();
      renderGrid();
    }, wasWatched ? 0 : 1000); // Delay for collapse animation to mostly complete
  }

  function renderList(){
    const movies = visibleMoviesForSidebar();
    listEl.innerHTML = "";
    movies.forEach((m, idx) => {
      const item = document.createElement("div");
      item.className = "item";
      item.tabIndex = 0;
      item.dataset.id = m.id;
      item.dataset.index = idx;

      const num = document.createElement("div");
      num.className = "num";
      
      // Show green check for watched movies
      if (watchedMovies.has(m.id)) {
        num.innerHTML = `<svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <polyline points="20,6 9,17 4,12"></polyline>
        </svg>`;
        num.style.backgroundColor = "rgba(34,197,94,.15)";
        num.style.borderColor = "rgba(34,197,94,.35)";
        num.style.color = "#22c55e";
      } else {
        num.textContent = m.rank;
      }

      const meta = document.createElement("div");
      meta.className = "meta";

      const title = document.createElement("div");
      title.className = "title";
      title.textContent = m.title;

      const sub = document.createElement("div");
      sub.className = "sub";
      sub.textContent = m.bonus ? "Bonus movie" : "Main list";

      meta.appendChild(title);
      meta.appendChild(sub);

      item.appendChild(num);
      item.appendChild(meta);

      item.addEventListener("click", () => selectMovie(m.id, false));
      item.addEventListener("keydown", (e) => {
        if(e.key === "Enter" || e.key === " "){
          e.preventDefault();
          selectMovie(m.id, false);
        }
      });

      listEl.appendChild(item);
    });

    // reset focus index if list shrinks
    if(focusedIndex >= movies.length) focusedIndex = movies.length - 1;
  }

  function renderGrid(){
    const movies = visibleMoviesForGrid();
    gridEl.innerHTML = "";
    movies.forEach(m => gridEl.appendChild(movieCard(m)));
  }

  function movieCard(m){
    const card = document.createElement("section");
    card.className = "card";
    card.id = "card-" + m.id;

    const header = document.createElement("div");
    header.className = "cardHeader";

    const left = document.createElement("div");
    left.className = "left";

    const h3 = document.createElement("h3");
    h3.textContent = (m.bonus ? "" : (m.rank + ". ")) + m.title;

    const chips = document.createElement("div");
    chips.className = "chips";
    const chipA = document.createElement("span");
    chipA.className = "chip";
    chipA.textContent = m.bonus ? "Bonus" : "Top 10";
    const chipB = document.createElement("span");
    chipB.className = "chip rt-chip";
    chipB.innerHTML = `${m.rtRating}% <img src="https://papaya.party/img/tomatometer.png" width="12" height="12" style="margin-left: 2px; vertical-align: -1px;" alt="tomato">`;
    chips.appendChild(chipA);
    chips.appendChild(chipB);

    left.appendChild(h3);
    left.appendChild(chips);

    // Create buttons container
    const buttons = document.createElement("div");
    buttons.style.display = "flex";
    buttons.style.gap = "8px";
    buttons.style.alignItems = "center";

    // Create watched button
    const watchedBtn = document.createElement("button");
    watchedBtn.className = watchedMovies.has(m.id) ? "watchedBtn watched" : "watchedBtn";
    watchedBtn.title = watchedMovies.has(m.id) ? "Mark as unwatched" : "Mark as watched";
    watchedBtn.innerHTML = watchedMovies.has(m.id) 
      ? `<svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
          <polyline points="20,6 9,17 4,12" stroke="currentColor" stroke-width="2" fill="none"/>
        </svg>`
      : `<svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <circle cx="12" cy="12" r="10"/>
          <path d="m9 12 2 2 4-4"/>
        </svg>`;

    watchedBtn.addEventListener("click", (e) => {
      e.preventDefault();
      toggleWatched(m.id);
    });

    const rt = document.createElement("a");
    rt.className = "rtLink";
    rt.href = m.rt;
    rt.target = "_blank";
    rt.rel = "noopener noreferrer";
    rt.innerHTML = `Rotten Tomatoes`;

    buttons.appendChild(watchedBtn);
    buttons.appendChild(rt);

    header.appendChild(left);
    header.appendChild(buttons);

    const body = document.createElement("div");
    body.className = "cardBody";

    const poster = document.createElement("img");
    poster.className = "poster";
    poster.alt = m.title + " poster";
    poster.loading = "lazy";
    poster.decoding = "async";
    poster.referrerPolicy = "no-referrer";
    poster.src = m.poster || "";

    const content = document.createElement("div");
    content.className = "cardContent";

    const w = document.createElement("div");
    w.innerHTML = `<p class="sectionTitle">What it is</p>
                   <p class="textBlock">${m.what.map(escapeHtml).join("<br/>")}</p>`;

    const y = document.createElement("div");
    y.innerHTML = `<p class="sectionTitle">Why it‚Äôs famous</p>
                   <p class="textBlock">${m.why.map(escapeHtml).join("<br/>")}</p>`;

    content.appendChild(w);
    content.appendChild(y);

    body.appendChild(poster);
    body.appendChild(content);

    // Collapsible behavior: click header toggles body, click RT link won't toggle
    let expanded = true;
    const toggle = () => {
      expanded = !expanded;
      body.style.display = expanded ? "grid" : "none";
    };
    header.addEventListener("click", (e) => {
      if(e.target.closest("a")) return;
      toggle();
    });

    card.appendChild(header);
    card.appendChild(body);
    return card;
  }

  function escapeHtml(str){
    return String(str)
      .replaceAll("&", "&amp;")
      .replaceAll("<", "&lt;")
      .replaceAll(">", "&gt;")
      .replaceAll('"', "&quot;")
      .replaceAll("'", "&#039;");
  }

  function selectMovie(id, openRt){
    const m = MOVIES.find(x => x.id === id);
    if(!m) return;

    // Don't change the default "Pick a movie" text and description

    // scroll card into view
    const card = document.getElementById("card-" + id);
    if(card) card.scrollIntoView({behavior:"smooth", block:"start"});

    // also open RT page if requested
    if(openRt){
      window.open(m.rt, "_blank", "noopener,noreferrer");
    }

    // highlight in list with more prominent selection border
    [...listEl.children].forEach(el => {
      if(el.dataset.id === id) {
        el.style.borderColor = "rgba(122,162,255,.85)";
        el.style.background = "rgba(122,162,255,.15)";
        el.style.boxShadow = "inset 0 0 0 2px rgba(122,162,255,.35)";
      } else {
        el.style.borderColor = "";
        el.style.background = "";
        el.style.boxShadow = "";
      }
    });

    // highlight the card in the main content area
    [...gridEl.querySelectorAll(".card")].forEach(card => {
      if(card.id === "card-" + id) {
        card.style.borderColor = "rgba(122,162,255,.65)";
        card.style.boxShadow = "0 0 0 2px rgba(122,162,255,.25), var(--shadow)";
      } else {
        card.style.borderColor = "";
        card.style.boxShadow = "var(--shadow)";
      }
    });
  }

  function expandCollapseAll(expand){
    const cards = [...gridEl.querySelectorAll(".card")];
    cards.forEach(card => {
      const body = card.querySelector(".cardBody");
      body.style.display = expand ? "grid" : "none";
    });
  }

  // Events
  searchEl.addEventListener("input", () => {
    query = searchEl.value;
    renderList();
    });

  toggleBonusEl.addEventListener("click", () => {
    showBonus = !showBonus;
    toggleBonusEl.setAttribute("aria-pressed", String(showBonus));
    renderList();
    renderGrid();
  });

  // Toggle expand/collapse state
  let allExpanded = true;
  
  $("#toggleExpand").addEventListener("click", () => {
    allExpanded = !allExpanded;
    expandCollapseAll(allExpanded);
    $("#toggleExpand").textContent = allExpanded ? "Collapse all" : "Expand all";
  });

  // Keyboard navigation for the list
  document.addEventListener("keydown", (e) => {
    // don't steal keystrokes while typing in search
    if(document.activeElement === searchEl) return;

    const movies = visibleMoviesForSidebar();
    if(!movies.length) return;

    if(e.key === "ArrowDown"){
      e.preventDefault();
      focusedIndex = Math.min(movies.length - 1, focusedIndex + 1);
      focusListItem(focusedIndex);
    } else if(e.key === "ArrowUp"){
      e.preventDefault();
      focusedIndex = Math.max(0, focusedIndex - 1);
      focusListItem(focusedIndex);
    } else if(e.key === "Enter" && focusedIndex >= 0){
      e.preventDefault();
      selectMovie(movies[focusedIndex].id, true);
    }
  });

  function focusListItem(idx){
    const el = listEl.children[idx];
    if(el) el.focus();
  }

  // Initial render
  renderList();
  renderGrid();
</script>
</body>
</html>
